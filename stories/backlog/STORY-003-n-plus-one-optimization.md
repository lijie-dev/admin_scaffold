# STORY-003: 优化数据库查询，解决 N+1 问题

## 用户故事
作为系统用户
我想要页面加载速度快
以便获得流畅的使用体验

## 背景
当前系统在加载列表页面时存在 N+1 查询问题：
- 用户列表页面加载角色时产生多次查询
- 角色列表页面加载权限和菜单时产生多次查询
- 缺少数据库索引导致查询缓慢

## 任务
- [ ] 审查所有 list_* 函数，识别 N+1 查询
- [ ] 为 list_users 添加角色 preload
- [ ] 为 list_roles 添加权限和菜单 preload
- [ ] 为关联表添加必要的数据库索引
- [ ] 优化 get_user_permissions 查询
- [ ] 添加查询性能测试

## 验收标准
- [ ] 列表页面只执行必要的数据库查询
- [ ] 所有外键都有索引
- [ ] 页面加载时间减少 50% 以上
- [ ] 查询性能测试通过

## 技术说明
使用 preload 优化查询：
```elixir
def list_roles do
  Role
  |> preload([:permissions, :menus])
  |> Repo.all()
end
```

## 依赖关系
无

## 完成定义
- [ ] 所有任务已完成
- [ ] 性能测试通过
- [ ] 代码已审查
